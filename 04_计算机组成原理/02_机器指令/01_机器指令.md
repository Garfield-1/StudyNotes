# 机器指令

参考文档

《深入理解计算机系统》 原书第三版             --机械工业出版社

## 机器指令步骤

通常，处理一条指令包括很多操作。将它们组织成某个特殊的阶段序列，即使指令的动作差异很大，但所有的指令都遵循统一的序列。每一步的具体处理取决于正在执行的指令。创建这样一个框架，我们就能够设计一个充分利用硬件的处理器。下面是关于各个阶段以及各阶段内执行操作的简略描述

### 取指

取指`fetch`：取指阶段从内存读取指令字节，地址为程序计数器`PC`的值。从指令中抽取出指令指示符字节的两个四位部分，称为`icode`(指令代码)和`ifun`(指令功能)。它可能取出一个寄存器指示符字节，指明一个或两个寄存器操作数指示符`rA`和`rB`。它还可能取出一个四字节常数字`valC`。它按顺序方式计算当前指令的下一条指令的地址`valP`。也就是说，`valP`等于`PC`的值加上已取出指令的长度。

### 译码

译码`decode`：译码阶段从寄存器文件读入最多两个操作数，得到值`valA`和`/`或`valB`。通常，它读入指令`rA`和`rB`字段指明的寄存器，不过有些指令是读寄存器`grsp`的。

执行`execute`：在执行阶段，算术/逻辑单元`ALU`要么执行指令指明的操作根据`ifun`的值,计算内存引用的有效地址，要么增加或减少栈指针。得到的值我们称为`valE`。在此，也可能设置条件码。对一条条件传送指令来说，这个阶段会检验条件码和传送条件(由`ifun`给出),如果条件成立，则更新目标寄存器。同样，对一条跳转指令来说，这个阶段会决定是不是应该选择分支。

### 访存

访存`memory`：访存阶段可以将数据写人内存，或者从内存读出数据。读出的值为`valM`。

### 写回

写回`write back`：写回阶段最多可以写两个结果到寄存器文件。

### 更新PC

更新PC`PC update`：将`PC`设置成下一条指令的地址。
