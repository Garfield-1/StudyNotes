# 802.11数据帧

[TOC]

## 数据帧概述

`IEEE 802.11-2016`标准定义了`15`种数据帧子类型，最常见的两种数据帧是数据子类型(通常称为简单数据帧)和`QoS`数据子类型。二者的区别在于，`QoS`数据帧的`QoS`控制字段携带服务类别信息。简单数据帧有时也称为非`QoS`数据帧

这两种数据帧的帧体都封装有`MSDU`净荷(上层信息)。出于数据保密性考虑，`MSDU`净荷通常经过加密。接入点或无线局域网控制器中的集成服务负责解密数据帧的`MSDU`净荷，然后取出并转换为`802.3`以太网帧

对于`802.11`简单数据帧或`QoS`数据帧，帧体的最大长度由`MSDU`的最大长度(`2304`字节以及加密产生的开销决定。以`802.11`数据帧的帧体为例，`WEP`加密会产生`8`字节开销，`TKIP`加密会产生`20`字节开销，而CCMP加密会产生`16`字节开销

`15`种数据帧子类型中的大多数其实并不存在。在`IEEE 802.11-2016`标准定义的`15`种数据帧中，**有11种目前仅停留在纸面上**。全部`15`种数据帧子类型如下所示(由于所有`PCF`或`HCCA`数据帧实际上从未使用过，因此**主要关注普通数据帧数据帧、空数据帧、Qos数据帧、Qos空帧子类型即可**

### 类型(Type)字段

| 比特值 | 帧类型 | 作用                       |
| ------ | ------ | -------------------------- |
| `00`   | 管理帧 | 发现接入点并加入基本服务集 |
| `01`   | 控制帧 | 确认传输成功并保留无线介质 |
| `10`   | 数据帧 | 携带上层`MSDU`净荷         |
| `11`   | 扩展帧 | 一种新的、灵活的帧格式     |

### 数据帧帧子类型(Subtype)字段

| 比特值 | 帧类型                                                     | 作用                                                         |
| ------ | ---------------------------------------------------------- | ------------------------------------------------------------ |
| `0000` | **普通数据帧**(`Data(simple data frame)`)                  | 携带上层协议数据（如`IP`包），使用`DCF`（分布式协调）机制传输，无`QoS`支持（适用于`802.11a/b/g`） |
| `0001` | **数据 + 无竞争确认**(`Data +CF-Ack`)                      | 在`PCF`（点协调功能） 模式下，既传输数据，又对前一个帧进行确认（`CF-Ack`）。现代`Wi-Fi`几乎不用`PCF` |
| `0010` | **数据 + 无竞争轮询**(`Data +CF-Poll`)                     | 在`PCF`模式下，`AP`发送此帧表示“我有数据发给你，同时轮询你是否有数据要发” |
| `0011` | **数据 + 确认 + 轮询**(`Data +CF-Ack +CF-Poll`)            | 同时完成三项功能：传数据、确认前帧、轮询`STA`。仅用于已废弃的`PCF`模式 |
| `0100` | **空数据帧（无负载）**(`Null(no data)`)                    | 不携带任何上层数据，但用于维持关联状态（如省电模式下告知`AP`“我还在线”），或触发响应（如漫游探测） |
| `0101` | **无竞争确认（无数据）**(`CF-Ack(no data)`)                | 仅用于`PCF`模式下的确认，无数据负载                          |
| `0110` | **无竞争轮询（无数据）**(`CF-Poll(no data)`)               | `AP`在`PCF`周期中轮询`STA`是否有数据要发送                   |
| `0111` | **确认 + 轮询（无数据）**(`CF-Ack +CF-Poll(no data)`)      | `PCF`模式下组合操作，无数据                                  |
| `1000` | **QoS数据帧**(`QoS Data`)                                  | 最常用的数据帧类型（`802.11e`及以后）。携带上层数据，并包含`QoS`控制字段（如`TID`、`EOSP`、`ACK policy`），支持`WMM`、语音/视频优先级、`A-MPDU`聚合等 |
| `1001` | **QoS数据 + 确认**(`QoS Data +CF-Ack`)                     | 理论上存在，但因`PCF`已弃用，实际几乎不会出现                |
| `1010` | **QoS数据 + 轮询**(`QoS Data +CF-Poll`)                    | 同上，仅在`PCF + QoS`混合场景（极罕见）                      |
| `1011` | **QoS数据 + 确认 + 轮询**(`QoS Data +CF-Ack +CF-Poll`)     | 同上，基本不用                                               |
| `1100` | **QoS空帧**(`QoS Null(no data)`)                           | 不携带数据，但包含`QoS`信息。常用于： • 客户端进入/退出省电模式（通过`EOSP`位） • 触发`AP`发送缓存帧 • 保持关联并声明流量类别（如`VoIP`流保活） |
| `1101` | **保留**(`Reserved`)                                       | 未使用                                                       |
| `1110` | **QoS轮询（无数据）**(`QoS CF-Poll(no data)`)              | 理论存在，实际不用（`PCF`已淘汰）                            |
| `1111` | **QoS确认+轮询（无数据）**(`QoS CF-Ack +CF-Poll(no data)`) | 同上，废弃                                                   |

## 笔者注

由于`PCF`机制的淘汰，**目前实际使用的数据帧类型只有Qos数据帧、Qos空帧、普通数据帧、空数据帧**这几种，本文只针对这部分数据帧进行讨论



## 参考文档

> 《无线局域网权威指南 第五版》
>
> [80211-2016规范](