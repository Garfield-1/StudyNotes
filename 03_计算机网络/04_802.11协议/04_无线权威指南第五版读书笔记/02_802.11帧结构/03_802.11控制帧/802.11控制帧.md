# 802.11控制帧

[TOC]

## 概述

无线终端使用管理帧加入和离开基本服务集，有线网络则不需要因为通过断开和连接网络电缆就可以实现相同目的。`802.11`管理帧又称为`MMPDU`，它不携带任何上层信息。`MMPDU`帧体并未封装`MSDU`，仅包含二层信息字段和信息元素。信息字段是固定长度的强制字段，而信息元素是可变长度的可选字段

`802.11`帧在帧头的类型和子类型字段共同定义了一个帧

### 类型(Type)字段

| 比特值 | 帧类型 | 作用                       |
| ------ | ------ | -------------------------- |
| `00`   | 管理帧 | 发现接入点并加入基本服务集 |
| `01`   | 控制帧 | 确认传输成功并保留无线介质 |
| `10`   | 数据帧 | 携带上层`MSDU`净荷         |
| `11`   | 扩展帧 | 一种新的、灵活的帧格式     |

### 控制帧子类型(Subtype)字段

| 比特值      | 帧类型                                          | 作用                                                         |
| ----------- | ----------------------------------------------- | ------------------------------------------------------------ |
| `0000-0011` | **保留**(`Reserved`)                            | 未使用                                                       |
| `0100`      | **波束成形报告轮询**(`Beamforming Report Poll`) | 在 `802.11ac/ax`中，`AP`用此帧请求客户端发送其波束成形反馈(`CSI`) |
| `0101`      | **VHT零数据包公告**(`VHT NDP Announcement`)     | 用于高吞吐量(`VHT, 802.11ac`)波束成形训练，通知即将发送`NDP`(`Null Data Packet`)以供信道探测 |
| `0110`      | **控制帧扩展**(`Control Frame Extension`)       | `802.11ax`引入，用于携带额外控制信息(如`HE-SIG`字段扩展)，支持`OFDMA`和`MU-MIMO`调度 |
| `0111`      | **控制封装帧**(`Control Wrapper`)               | 用于封装其他控制信息(如在`802.11n/ac`中封装多个`BlockAckReq`等)，较少见 |
| `1000`      | **块确认请求**(`Block Ack Request`)             | 请求接收方对一组已接收的`MPDU`发送`Block Ack`(批量确认)，提高效率 |
| `1001`      | **块确认**(`Block Ack`)                         | 对接收到的一组数据帧进行批量`ACK`，减少`ACK`开销(常用于高吞吐场景) |
| `1010`      | **省电轮询**(`PS-Po11`)                         | (`Power Save Poll`)：处于省电模式的 `STA` 用此帧向`AP`请求缓存的数据帧 |
| `1011`      | **请求发送**(`RTS`)                             | (`Request To Send`)：用于`CSMA/CA`的握手机制，预留信道(配合`CTS`使用) |
| `1100`      | **清除发送**(`CTS`)                             | (`Clear To Send`)：响应`RTS`，告知其他设备信道已被占用，同时允许`RTS`发送方开始传输 |
| `1101`      | **确认帧**(`Ack`)                               | 对单个数据帧的成功接收进行确认(最常用的控制帧之一)           |
| `1110`      | **无竞争结束**(`CF-End`)                        | (`Contention Free End`)：在旧式`PCF`(点协调功能)模式下，标记无竞争周期结束 |
| `1111`      | **无竞争结束 + 确认**(`CF-End +CF-Ack`)         | 同上，但同时确认前一个帧(仅用于`PCF`模式)                    |

## 波束成形报告轮询(Beamforming Report Poll)

### Beamforming Report Poll帧主体

> 笔者注：Beamforming Report Poll帧中的元素是否被使用取决于具体情况，**详情见IEEE 802.11-2016文档9.3.1.21**

## VHT零数据包公告(VHT NDP Announcement)

## 控制帧扩展(Control Frame Extension)

## 块确认请求(Block Ack Request)

## 块确认(Block Ack)

## 省电轮询(PS-Po11)

## 请求发送(RTS)

## 清除发送(CTS)

## 确认帧(Ack)

## 无竞争结束(CF-End)

## 无竞争结束 + 确认(CF-End +CF-Ack)

## 参考文档

> 《无线局域网权威指南 第五版》
>
> [80211-2016规范](https://github.com/Garfield-1/Books/blob/master/11_802.11协议规范/80211-2016.pdf)